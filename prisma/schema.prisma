// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String        @id @default(uuid())
  firstName      String
  middleName     String?
  lastName       String
  username       String        @unique
  password       String
  role           Role
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  recordEntries  RecordEntry[]
  createdRecords Record[]

  @@index([role])
  @@index([username])
  @@index([firstName, lastName])
  @@map("users")
}

enum Role {
  SUPER_ADMIN
  ADMIN
  STUDENT
}

model Record {
  id              String @id @default(uuid())
  title           String
  createdByUserId String
  createdByUser   User   @relation(fields: [createdByUserId], references: [id], onDelete: Cascade)

  recordLinks   RecordLink[]
  recordEntries RecordEntry[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("records")
}

model RecordLink {
  id       String   @id @default(uuid())
  recordId String
  record   Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)
  type     LinkType @default(ONE_TIME_USE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("record_links")
}

enum LinkType {
  ONE_TIME_USE
  MULTIPLE_USE
}

model RecordEntry {
  id       String @id @default(uuid())
  recordId String
  userId   String

  record Record @relation(fields: [recordId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([recordId, userId])
  @@index([userId])
  @@map("record_entries")
}
